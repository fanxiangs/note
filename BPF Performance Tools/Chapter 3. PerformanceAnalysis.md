Learning objectives: 
• Understand the goals and activities of performance analysis  
• Perform workload characterization  
• Perform the USE method  
• Perform drill down analysis  
• Understand checklist methodologies  
• Find quick performance wins using traditional tools and  the 60 second Linux checklist  
• Find quick performance wins using the BCC/BPF tool  checklist
## LINUX 60-SECOND ANALYSIS
**Linux 60-Second Analysis** 是一种快速的性能诊断方法，通常在遇到性能问题时，在登录到系统后的第一分钟内执行。这个清单帮助用户快速了解系统的整体状态，定位可能的性能瓶颈。以下是 60 秒分析中使用的工具及其作用说明：

---

### **1. uptime**

- **功能**：显示系统的运行时间、当前时间、系统负载等信息。
- **用途**：了解系统的负载情况。如果负载过高（load average 数值大于 CPU 核心数），可能表明系统过载。
- **场景**：快速检查系统是否超载，是否有资源瓶颈。

---

### **2. dmesg | tail**

- **功能**：查看系统的内核消息，`dmesg` 命令用于显示内核环形缓冲区的日志，`tail` 显示最后几行日志。
- **用途**：检查启动时和运行中的内核警告和错误信息，特别是硬件问题、内存不足或磁盘 I/O 错误。
- **场景**：初步诊断硬件故障或内核级错误。

---

### **3. vmstat 1**

- **功能**：显示系统的虚拟内存、进程、CPU 活动等统计信息。`1` 表示每秒更新一次。
- **用途**：监控内存使用情况、CPU 使用率、I/O 等，可以帮助分析系统是否处于资源瓶颈状态（如交换空间过度使用或 CPU 过度负载）。
- **场景**：了解系统资源使用的整体状况，定位内存或 CPU 的瓶颈。

---

### **4. mpstat -P ALL 1**

- **功能**：查看每个 CPU 核心的使用情况。`-P ALL` 参数表示查看所有 CPU 核心的状态，`1` 表示每秒更新一次。
- **用途**：帮助分析是否有某些 CPU 核心出现过载现象。
- **场景**：检查系统是否存在 CPU 核心不均衡的情况，是否有进程消耗过多 CPU。

---

### **5. pidstat 1**

- **功能**：显示每个进程的 CPU 使用情况、内存占用、I/O 操作等。`1` 表示每秒更新一次。
- **用途**：找出哪些进程占用了最多的 CPU、内存或 I/O。
- **场景**：快速定位高资源消耗的进程，为进一步的优化或诊断提供线索。

---

### **6. iostat -xz 1**

- **功能**：查看磁盘的 I/O 性能统计。`-x` 表示显示详细信息，`-z` 去掉没有 I/O 活动的设备，`1` 表示每秒更新一次。
- **用途**：查看磁盘的读取/写入速率、响应时间等，以评估磁盘是否成为性能瓶颈。
- **场景**：诊断磁盘性能问题，识别高 I/O 延迟的磁盘或设备。

---

### **7. free -m**

- **功能**：显示系统内存的使用情况，以 MB 为单位。
- **用途**：快速查看内存的使用情况，检查是否存在内存不足或交换空间（swap）使用过高的现象。
- **场景**：诊断内存瓶颈，确认是否需要优化内存分配或升级硬件。

---

### **8. sar -n DEV 1**

- **功能**：显示网络设备的统计信息。`-n DEV` 参数表示查看网络设备的流量数据，`1` 表示每秒更新一次。
- **用途**：检查网络接口的带宽使用情况、丢包率等，判断是否有网络瓶颈或故障。
- **场景**：分析网络流量，找出可能的网络瓶颈。

---

### **9. sar -n TCP,ETCP 1**

- **功能**：查看 TCP 连接和 Ethernet 连接的状态统计信息。
- **用途**：检查网络连接的健康状况，查看当前的 TCP 连接数、重传率等，帮助诊断网络协议层的问题。
- **场景**：排查 TCP 连接问题，找出潜在的网络延迟或丢包问题。

---

### **10. top**

- **功能**：显示系统当前运行的进程，按 CPU 或内存占用排序，并实时更新。
- **用途**：查看系统上运行的进程，快速定位资源消耗较大的进程。
- **场景**：分析进程资源占用情况，帮助找出性能瓶颈。

---
### **清单工具总结**

1. **uptime**：检查系统负载。
2. **dmesg | tail**：查看内核日志，检查硬件问题。
3. **vmstat 1**：检查内存、CPU、I/O 状态。
4. **mpstat -P ALL 1**：检查每个 CPU 核心的负载。
5. **pidstat 1**：查看各进程资源占用。
6. **iostat -xz 1**：检查磁盘 I/O 性能。
7. **free -m**：检查内存使用情况。
8. **sar -n DEV 1**：监控网络设备流量。
9. **sar -n TCP,ETCP 1**：检查网络连接的健康状况。
10. **top**：查看进程资源占用。

## BCC TOOL CHECKLIST
**BCC Tool Checklist** 是一组用于性能分析和故障排查的工具，旨在通过跟踪系统行为来识别性能瓶颈。BCC（BPF Compiler Collection）是一个包含大量工具的框架，这些工具基于 eBPF，能够在内核中动态插入代码，提供实时性能监控。下面是 BCC 工具清单的详细说明，每个工具的功能和用途：

---

### **1. execsnoop**

- **功能**：监控并记录系统上执行的每个程序。
- **用途**：用来查看系统中正在运行的命令或程序，帮助排查是否有异常或意外的程序启动。
- **场景**：监控恶意程序的启动，或跟踪特定进程的行为。

---

### **2. opensnoop**

- **功能**：跟踪所有打开的文件或网络连接。
- **用途**：检查哪些文件被打开，哪些文件描述符被访问。
- **场景**：诊断 I/O 性能瓶颈，分析文件系统操作，或者调试程序访问文件的行为。

---

### **3. ext4slower** (或 **btrfs***、**xfs***、**zfs***)

- **功能**：监控文件系统的性能，特别是对特定文件系统（如 ext4、btrfs、xfs 或 zfs）的慢操作进行追踪。
- **用途**：帮助定位文件系统操作的延迟，找到慢磁盘操作或文件访问问题。
- **场景**：文件系统性能优化，尤其是在存储子系统上。

---

### **4. biolatency**

- **功能**：监控块设备（如磁盘）的 I/O 延迟。
- **用途**：找出磁盘 I/O 的延迟热点，帮助分析磁盘性能瓶颈。
- **场景**：定位磁盘性能问题，特别是在高负载环境中，I/O 延迟可能成为系统瓶颈。

---

### **5. biosnoop**

- **功能**：跟踪所有的磁盘 I/O 操作，包括读写请求。
- **用途**：分析磁盘操作的细节，查看哪些进程或系统调用正在进行磁盘 I/O 操作。
- **场景**：调试磁盘瓶颈，分析程序对磁盘的访问模式。

---

### **6. cachestat**

- **功能**：显示 CPU 缓存的命中率和使用情况。
- **用途**：诊断 CPU 缓存命中率，帮助找出性能低效的内存访问模式。
- **场景**：优化内存访问模式，减少 CPU 缓存未命中的情况。

---

### **7. tcpconnect**

- **功能**：监控系统上所有的 TCP 连接，包括发起连接的源 IP、目标 IP 和端口。
- **用途**：分析网络连接的行为，特别是在调试网络应用时，用于了解哪些服务正在建立连接。
- **场景**：网络故障排查、分析应用程序的网络活动。

---

### **8. tcpaccept**

- **功能**：跟踪系统上所有被接受的 TCP 连接。
- **用途**：帮助了解哪些服务接受了连接，查看连接的详细信息。
- **场景**：分析服务端接受连接的情况，检查可能的性能瓶颈。

---

### **9. tcpretrans**

- **功能**：检测和监控 TCP 重传。
- **用途**：帮助分析网络中的丢包或延迟问题，找出网络性能的潜在问题。
- **场景**：定位网络问题，特别是与丢包和延迟相关的问题。

---

### **10. runqlat**

- **功能**：监控进程在运行队列中的等待时间。
- **用途**：帮助定位 CPU 调度的延迟，找出调度过程中可能存在的性能瓶颈。
- **场景**：优化多核 CPU 的负载均衡，减少进程等待时间。

---

### **11. profile**

- **功能**：进行 CPU 样本采样，分析哪些函数消耗了最多的 CPU 时间。
- **用途**：帮助进行函数级别的性能分析，找出热点函数。
- **场景**：进行深度性能优化，尤其是在计算密集型应用中，优化代码路径。

---

### **总结**

这个 BCC 工具清单提供了一系列功能强大的工具，可以帮助你在多层次上进行性能分析，从进程执行到 I/O 延迟，从文件系统到网络连接。结合这些工具，可以全面了解系统的性能瓶颈，并做出针对性的优化。每个工具都为特定的性能问题提供了解决方案，适用于不同的分析场景和需求。

这些工具非常适合用来进行快速的系统监控和问题定位，并且是后续更深层次的 BPF（eBPF）分析的基础。