# BPF Skeletons

[[null|]][[null|]][[null|]]You can use `bpftool` to auto-generate this skeleton code from existing eBPF objects in ELF file format, like this:

bpftool gen skeleton hello-buffer-config.bpf.o > hello-buffer-config.skel.h

Look into this skeleton header and you’ll see that it contains structure definitions for the eBPF programs and maps, as well as several functions that all start with the name `hello_buffer_config_bpf__` (based on the name of the object file). These functions manage the lifecycle of the eBPF programs and maps. You don’t have to use the skeleton code—you can make calls to _libbpf_ directly if you prefer—but the auto-generated code will typically save you some typing.

Toward the end of the generated skeleton file you’ll see a function called `hello_buffer_config_bpf__elf_bytes` that returns the byte contents of the ELF object file _hello-buffer-config.bpf.o_. Once the skeleton has been generated, we don’t really need that object file anymore. You can test this by running `make` to generate the `hello-buffer-config` executable and then deleting the _.o_ file; the executable has the eBPF bytecode contained within it.

##### Note

If you prefer, you can use the _libbpf_ function `bpf_object__open_file` to load the eBPF programs and maps from an ELF file rather than using the bytes from a skeleton file.

Here’s the outline of the user space code that manages the lifecycle of the eBPF program and maps for this example, using the generated skeleton code. I have omitted some of the details and error handling for clarity, but you’ll find the full source code in _chapter5/hello-buffer-config.c_.

    .

[[#code_id_5_5|]]

This file includes the auto-generated skeleton header, as well as the header file I wrote manually for data structures shared between the user space and kernel code.

[[#code_id_5_6|]]

This code sets a callback function that will print any log messages generated by _libbpf_.

[[#code_id_5_7|]]

Here a `skel` structure is created that represents all the maps and programs defined in the ELF bytes and loads them into the kernel.

[[#code_id_5_8|]]

Programs are auto-attached to the appropriate events.

[[#code_id_5_9|]]

This function creates a structure for handling the perf buffer output.

[[#code_id_5_10|]]

Here that perf buffer is continuously polled.

[[#code_id_5_11|]]

This is the clean-up code.

Let’s dive into some of those steps in more detail.